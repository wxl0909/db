
<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>栏目管理 - QAdmin后台模板</title>
    <link rel="stylesheet" href="./static/common/layui/css/layui.css">
    <link rel="stylesheet" href="./static/admin/css/style.css">
    <script src="./static/common/jquery-3.3.1.min.js"></script>
    <script src="./static/common/layui/layui.js"></script>
    <script src="./static/common/vue.min.js"></script>
</head>
<body>
<div id="app">
    <!--顶栏-->
    <header>
        <h1 v-text="webname"></h1>
        <div class="breadcrumb">
            <i class="layui-icon">&#xe715;</i>
            <ul>
                <li v-for="vo in address">
                    <a  v-text="vo.name" :href="vo.url" ></a> <span>/</span>
                </li>
            </ul>
        </div>
    </header>

    <div class="main">
        <!--左栏-->
        <div class="left">
            <ul class="cl" >
                <!--顶级分类-->
                <li v-for="vo,index in menu" :class="{hidden:vo.hidden}">
                    <a href="javascript:;"  :class="{active:vo.active}"  @click="onActive(index)">
                        <i class="layui-icon" v-html="vo.icon"></i>
                        <span v-text="vo.name"></span>
                        <i class="layui-icon arrow" v-show="vo.url.length==0">&#xe61a;</i> <i v-show="vo.active" class="layui-icon active">&#xe623;</i>
                    </a>
                    <!--子级分类-->
                    <div v-for="vo2,index2 in vo.list">
                        <a href="javascript:;" :class="{active:vo2.active}" @click="onActive(index,index2)" v-text="vo2.name"></a>
                        <i v-show="vo2.active" class="layui-icon active">&#xe623;</i>
                    </div>
                </li>
            </ul>
        </div>
        <!--右侧-->
        <div class="right">
            <fieldset class="layui-elem-field layui-field-title">
                <legend>角色管理</legend>
            </fieldset>
            <a href="type_add.html" class="layui-btn"><i class="layui-icon">&#xe654;</i>添加管理</a>
            <!--<a href="type_add.html" class="layui-btn"><i class="layui-icon">&#xe654;</i>批量删除管理</a>-->
            <!--角色列表-->
            <table id="demo" lay-filter="test"></table>
        </div>
    </div>
</div>
<script>
    layui.use('table', function(){
        var table = layui.table;

        //第一个实例
        table.render({
            elem: '#demo'
            ,height: 312
            ,url: 'role/queryAllRole' //数据接口
            ,page: true //开启分页
            ,cols: [[ //表头
                {field: 'id', title: 'ID', width:80, sort: true, fixed: 'left'}
                ,{field: 'roleName', title: '角色名', width:100}
                ,{field: 'userList', title: '用户列表', width:180, sort: true ,templet: function(d){
                        var temp = "";
                        for (var i = 0; i <d.userList.length; i++) {if (d.userList.length==1)
                        {temp=d.userList[i].name;}else {temp+=d.userList[i].name+"，";}}return temp;}}
                ,{field: 'roleDesc', title: '描述', width:180,templet: function(d){return d.roleDesc;}}
                ,{field: '#', title: '操作', width:180,toolbar: '#barDemo'}
                ]]
            ,parseData: function(res){ //res 即为原始返回的数据
                    console.log(res);
                return {
                    "code": res.code, //解析接口状态
                    "msg": res.message, //解析提示文本
                    "count": res.pageInfo.total, //解析数据长度
                    "data": res.pageInfo.list //解析数据列表
                };
            }
            ,request: {
                pageName: 'pageNum' //页码的参数名称，默认：page
                ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
            }
        });
//监听工具条
        table.on('tool(test)', function(obj){ //注：tool 是工具条事件名，test 是 table 原始容器的属性 lay-filter="对应的值"
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            var tr = obj.tr; //获得当前行 tr 的 DOM 对象（如果有的话）
            if(layEvent === 'del'){ //删除
                layer.confirm('真的删除行么', function(index){
                    obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
                    layer.close(index);
                    //向服务端发送删除指令
                    del(obj.data.id);
                });
            } else if(layEvent === 'edit'){ //编辑
                //向页面传递id
                console.log(obj.data.id)
                window.location.href="roleManagerEdit.html?id="+obj.data.id;
            } else if(layEvent === 'LAYTABLE_TIPS'){
                layer.alert('Hi，头部工具栏扩展的右侧图标。');
            }
        });
    });

    function del(id) {
        $.post("role/del",{"id":id},
            function (data) {
                if (data==1){
                    alert("删除成功");
                } else {
                    alert("删除失败");
                }
        },"json");
    }
</script>
<!--添加编辑按钮-->
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script src="./static/admin/js/config.js"></script>
<script src="./static/admin/js/script.js"></script>

</body>
</html>